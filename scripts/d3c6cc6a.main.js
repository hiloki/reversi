var App={};!function(){"use strict";var a="black",b="white",c="none";App.ReversiModel=Backbone.Model.extend({initialize:function(){this.set("color",c,{slient:!0})},getColor:function(){return this.get("color")},setColor:function(a){return a===this.get("color")?!0:App.ReversiModel.validColorCode(a)?(this.set("color",a),!0):!1},hasColor:function(){return this.get("color")!==c}},{colorCode:{black:a,white:b,none:c},validColorCode:function(a){return _.indexOf(_.values(this.colorCode),a)>-1}})}(),function(){"use strict";App.CellModel=Backbone.Model.extend({row:0,col:0,reversi:null,initialize:function(a){a=_.extend({row:0,col:0},a),this.row=a.row,this.col=a.col,this.reversi=new App.ReversiModel},putReversi:function(a){return this.reversi.setColor(a)},putBlackReversi:function(){return this.reversi.setColor(App.ReversiModel.colorCode.black)},putWhiteReversi:function(){return this.reversi.setColor(App.ReversiModel.colorCode.white)},hasReversi:function(){return this.reversi.hasColor()},getPoint:function(a){return a?{row:this.row,col:this.col}:[this.row,this.col]},getColor:function(){return this.reversi.getColor()},enableToPut:function(){var a=this.getAroundCell();return _.each(a,function(a){return a.hasReversi()?!0:void 0}),!1},getAroundCell:function(){var a=[],b=[[this.row-1,this.col-1],[this.row-1,this.col],[this.row-1,this.col+1],[this.row,this.col-1],[this.row,this.col+1],[this.row+1,this.col-1],[this.row+1,this.col],[this.row+1,this.col+1]];return b=_.filter(b,function(a){var b=a[0],c=a[1];return b>=0&&c>=0}),_.each(b,_.bind(function(b){a.push(this.collection.search(b[0],b[1]))},this)),a}})}(),function(){"use strict";var a=App.ReversiModel.colorCode;App.CellCollection=Backbone.Collection.extend({model:App.CellModel,edge:0,initialize:function(a,b){var c=this.edge=b.edge;a=[];for(var d=0;c>d;d++)for(var e=0;c>e;e++)a.push(new App.CellModel({row:d,col:e}));this.reset(a,_.extend({silent:!0},b)),this.setInitialReversi()},setInitialReversi:function(){var b=this.edge;this.addReversi(b/2-1,b/2-1,a.black),this.addReversi(b/2-1,b/2,a.white),this.addReversi(b/2,b/2-1,a.white),this.addReversi(b/2,b/2,a.black)},addReversi:function(a,b,c){var d=this.search(a,b);return!d||d.hasReversi()?!1:d.putReversi(c)},search:function(a,b){var c=this.filter(function(c){return c.row===a&&c.col===b});return c.length?c[0]:null},getCellsWithReversi:function(){return this.filter(function(a){return a.hasReversi()})}})}(),function(){"use strict";App.ReversiView=Backbone.View.extend({tagName:"div",className:"reversi",model:null,initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){if(this.model.hasColor()){var a=this.model.getColor();this.$el.addClass(a)}else this.$el.removeClass(),this.$el.addClass(this.className);return this}})}(),function(){"use strict";var a=App.ReversiModel.colorCode;App.CellView=Backbone.View.extend({tagName:"td",className:"cell",model:null,events:{click:"onClick"},onClick:function(){this.model.putReversi(a.black)},render:function(){var a=new App.ReversiView({model:this.model.reversi});return this.$el.html(a.render().el),this}})}(),function(){"use strict";App.BoardView=Backbone.View.extend({tagName:"table",className:"board",collection:null,edge:0,initialize:function(a){var b=this.edge=a.edge;this.collection=new App.CellCollection(!1,{edge:b})},render:function(){for(var a=this.edge,b=[],c=0;a>c;c++){for(var d=$("<tr>"),e=[],f=0;a>f;f++){var g=new App.CellView({model:this.collection.search(c,f)});e.push(g.render().$el)}b.push(d.append(e))}return this.$el.append(b),this}})}(),function(){"use strict";var a=8,b=new App.BoardView({edge:a});$("#main").append(b.render().$el)}();