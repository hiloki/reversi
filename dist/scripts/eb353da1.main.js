var App={};!function(){"use strict";var a="black",b="white",c="none";App.ReversiModel=Backbone.Model.extend({cell:null,initialize:function(a){this.set("color",c,{slient:!0}),this.cell=a},getColor:function(){return this.get("color")},setColor:function(a){return a===this.get("color")?!0:App.ReversiModel.validColor(a)?(this.set("color",a),!0):!1},hasColor:function(a){return a?this.get("color")===a:this.get("color")!==c},toggle:function(){return this.getColor()===a?this.setColor(b):this.getColor()===b?this.setColor(a):void 0},hasDifferentColor:function(c){return c===b?this.get("color")===a:c===a?this.get("color")===b:!1}},{colorCode:{black:a,white:b,none:c},validColor:function(a){return _.indexOf(_.values(this.colorCode),a)>-1}})}(),function(){"use strict";App.CellModel=Backbone.Model.extend({row:0,col:0,reversi:null,initialize:function(a){a=_.extend({row:0,col:0},a),this.row=a.row,this.col=a.col,this.reversi=new App.ReversiModel(this)},putReversi:function(a,b){return b=_.extend({validation:!0,reverse:!0},b),b.validation&&this.hasReversi()?!1:b.reverse&&!this.reverse(a)&&b.validation?!1:this.reversi.setColor(a)},putBlackReversi:function(){return this.reversi.setColor(App.ReversiModel.colorCode.black)},putWhiteReversi:function(){return this.reversi.setColor(App.ReversiModel.colorCode.white)},hasReversi:function(){return this.reversi.hasColor()},getPoint:function(a){return a?{row:this.row,col:this.col}:[this.row,this.col]},getColor:function(){return this.reversi.getColor()},reverse:function(a){for(var b=[{row:-1,col:-1},{row:-1,col:0},{row:-1,col:1},{row:0,col:-1},{row:0,col:1},{row:1,col:-1},{row:1,col:0},{row:1,col:1}],c=0,d=0,e=b.length;e>d;d++){var f=b[d];this.canReverse(this,f,a)&&(c+=this.toggleRecursively(this,f,a))}return c>0},canReverse:function(a,b,c){var d=a.row+b.row,e=a.col+b.col,a=this.collection.search(d,e);return a?a.hasReversi()?a.reversi.hasDifferentColor(c)?this.canReverse(a,b,c):!0:!1:!1},toggleRecursively:function(a,b,c){var d=a.row+b.row,e=a.col+b.col,a=this.collection.search(d,e);return a&&a.hasReversi()&&a.reversi.hasDifferentColor(c)?(a.reversi.toggle(),1+this.toggleRecursively(a,b,c)):0}})}(),function(){"use strict";var a=App.ReversiModel.colorCode;App.CellCollection=Backbone.Collection.extend({model:App.CellModel,edge:0,initialize:function(a,b){var c=this.edge=b.edge;a=[];for(var d=0;c>d;d++)for(var e=0;c>e;e++)a.push(new App.CellModel({row:d,col:e}));this.reset(a,_.extend({silent:!0},b)),this.setInitialReversi()},setInitialReversi:function(){var b=this.edge;this.addReversi(b/2-1,b/2-1,a.black),this.addReversi(b/2-1,b/2,a.white),this.addReversi(b/2,b/2-1,a.white),this.addReversi(b/2,b/2,a.black)},addReversi:function(a,b,c){var d=this.search(a,b);return d?d.putReversi(c,{validation:!1,reverse:!1}):!1},putReversi:function(a,b){var c=this.search(a,b);return c?c.putReversi(color):!1},search:function(a,b){var c=this.filter(function(c){return c.row===a&&c.col===b});return c.length?c[0]:null},getCellsWithReversi:function(){return this.filter(function(a){return a.hasReversi()})},getReversies:function(a){var b=this.getCellsWithReversi(),c=_.map(b,function(a){return a.reversi});return a?_.filter(c,function(b){return b.getColor()===a}):c},countReversies:function(a){return this.getReversies(a).length}})}(),function(){"use strict";App.ReversiView=Backbone.View.extend({tagName:"div",className:"reversi",model:null,initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){if(this.$el.removeClass(),this.model.hasColor()){var a=this.model.getColor();this.$el.addClass(a)}return this.$el.addClass(this.className),this}})}(),function(){"use strict";App.ReversiModel.colorCode;App.CellView=Backbone.View.extend({tagName:"td",className:"cell",model:null,events:{click:"onClick"},onClick:function(a){a.stopPropagation();var b=$("input[name=color]:checked").val();this.model.putReversi(b)},render:function(){var a=new App.ReversiView({model:this.model.reversi});return this.$el.html(a.render().el),this}})}(),function(){"use strict";App.BoardView=Backbone.View.extend({tagName:"table",className:"board",collection:null,edge:0,initialize:function(a){var b=this.edge=a.edge;this.collection=new App.CellCollection(!1,{edge:b})},render:function(){for(var a=this.edge,b=[],c=0;a>c;c++){for(var d=$("<tr>"),e=[],f=0;a>f;f++){var g=new App.CellView({model:this.collection.search(c,f)});e.push(g.render().$el)}b.push(d.append(e))}return this.$el.append(b),this}})}(),function(){"use strict";var a=8,b=new App.BoardView({edge:a});$("#main").append(b.render().$el)}();